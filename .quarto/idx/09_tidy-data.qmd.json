{"title":"Tidy data","markdown":{"yaml":{"output":"html_document","editor_options":{"chunk_output_type":"console"}},"headingText":"Tidy data","containsRefs":false,"markdown":"\n\n\n```{r}\n#| label: setup\n#| include: false\n\n# set options\nknitr::opts_chunk$set(\n  tidy = FALSE, \n  message = FALSE,\n\twarning = FALSE)\n\noptions(htmltools.dir.version = FALSE)\n\n```\n\n\n**Learning Objectives**\n\nAfter completing this lab you should be able to \n\n* describe what a tidy data set is.\n* use `pivot_longer()` to convert a wide data set to a tidy (long) data set.\n* use `pivot_wider()` to convert a long (tidy) data set to a wide data set.\n\n\nFor each of our modules we will have a project-folder with an `Rproject`, `*.qmd`-files, and sub-directories for data, scripts, and results as described in our `Rproject` Tutorial. You should have a directory on your Desktop or Documents folder on your laptop (name it something like `bi349`) as a home directory for all of our project folders this semester. \n\n[You should have already downloaded the project directory for this module ](https://drive.google.com/drive/folders/1Sh4mtvdii1k_vU4-mfvgIGwJsZvo8MOt?usp=sharing), make sure the directory is unzipped and move it to your `bi328` directory. You can open the `Rproj` for this module either by double clicking on it which will launch `Rstudio` or by opening `Rstudio` and then using `File > Open Project` or by clicking on the `Rproject` icon in the top right of your program window and selecting `Open Project`. \n\nOnce you have opened a project you should see the project name in the top right corner^[Pro tip: If you run into issues where a quarto document won't render or file paths aren't working (especially if things were working previously) one of your first steps should be to double check that the correct `Rproj` is loaded.].\n\nThere should be a document named `09_tidy-data.qmd` in your project directory. Use that file to work through this tutorial - you will hand in your rendered (\"knitted\") `quarto` file as your homework assignment. So, first thing in the `YAML` header, change the author to your name. You will use this `quarto` document to record your answers. Remember to use comments to annotate your code; at minimum you should have one comment per code set^[You should do this whether you are adding code yourself or using code from our manual, even if it isn't commented in the manual... especially when the code is already included for you, add comments to describe how the function works/what it does as we introduce it during the participatory coding session so you can refer back to it.] you may of course add as many comments as you need to be able to recall what you did]. Similarly, take notes in the document as we discuss discussion/reflection questions but make sure that you go back and clean them up for \"public consumption\".\n\nLet's start by loading the packages we will need for this activity.\n\n```{r}\n\n# load libraries\nlibrary(knitr)\nlibrary(tidyverse)\n\n```\n\n## Producing tidy data sets\n\nThe last set of functions that we need to get comfortable with allow us to create tidy data sets. \n\n::: {.callout-note icon=false}\n\n## {{< fa clipboard-question >}}   Consider this\n\nList the three characteristics of a tidy data set. Explain why a tidy data set is sometimes also describe as a long data set.\n\n:::\n\n\n::: {.callout-important icon=false}\n\n## {{< fa pen >}}   Did it!\n\n[Your answer here]\n\n:::\n\nLet's read out data set back into our R session.\n\n```{r}\n\n# read catch data\ncatch <- read_delim(\"data/longline_catchdata.txt\", delim = \"\\t\")\n\n```\n\n::: {.callout-note icon=false}\n\n## {{< fa clipboard-question >}}   Consider this\n\nTake a look at our data set and argue whether or not it is a tidy data set. The easiest way to do this is to determine if it fullfills all the characteristics.\n\n:::\n\n\n::: {.callout-important icon=false}\n\n## {{< fa pen >}}   Did it!\n\n[Your answer here]\n\n:::\n\nLet's quickly reformat our catch data as follows\n\n```{r}\n\ncatch_length <- catch %>%\n  unite(SetID, Year, Month, Day, Set, sep = \"_\") %>%\n  select(SetID, Site, Species, Sex, PCL, FL, STL)\n\nhead(catch_length)\n\n```\n\nWe can turn this into a tidy data set using `pivot_longer()`. To do this we have to identify columns that will be used as the key (`cols = `) and then name the column that will hold those values (`names_to()`) and the column that will hold the value (`values_to()`).\n\nIn this case, we have made three observations about length for each specimen, in order to have rows with unique observations we want a column that identifies what type of observation was made, for example called `Measurement`. This is called the \"key\" because it allows us to \"unlock\" what type of measurement the individual observation is, i.e. this column will let us know whether an observation (row) is pre-caudal length, fork length, or stretch total length.\n\nWe will designate another column `Length` to hold the values for each measurement.\n\nWe can identify the columns that need to be gathered either by name or since we have re-arranged our dataframe so they are the last columns by column number.\n\n```{r}\n\ntidy_length <- catch_length %>%\n  pivot_longer(names_to = \"Measurement\", values_to = \"Length\", cols = 5:7)\n\n```\n\n::: {.callout-note icon=false}\n\n## {{< fa clipboard-question >}}   Consider this\n\nBriefly outline advantages to using tidy data sets.\n\n:::\n\n::: {.callout-important icon=false}\n\n## {{< fa pen >}}   Did it!\n\n[Your answer here]\n\n:::\n\nWith this data set it would be straightforward for us to e.g. calculate mean values for each length measurement by species using `group_by()` and `summarize()`.\n\n```{r}\n\ntidy_length %>%\n  group_by(Species, Measurement) %>%\n  summarize(mean = mean(Length, na.rm = TRUE))\n\n```\n\n\n## Convert a tidy data set to wide format\n\nDespite all the advantages of tidy data sets you can see from the table above that frequently when we are presenting results in a table it may be advantageous in terms of layout to have a non-tidy format. \n\nThis can be done using `pivot_wider()` which works like `pivot_longer()` but in reverse. You designate which column is the key (`names_from = `), i.e. these will become the column names in the new table. Then you need to identify which column in your current data frame contains the values that should be filled out/spread into the columns that will be generated from your key (`values_from =`).\n\nSince we don't have values for precaudal length, we probably want to use `filter()` to remove those rows first.\n\n::: {.column-margin}\n\nMore notes on naming things ... recall, that we said that filenames should not contain spaces or special characters? We set similar rules for naming objects. Well, column names is a similar conundrum. Including spaces or species characters as a column name creates problems when we are using functions like `select()` to subset by column name or `mutate()` to create new columns based on exisiting columns. Similarly, if the column name is a number you will have problems. If you do have unconvential column names you can rename them using `rename()` or you can use backticks and either side of the name to indicate that it is a column name.\n\n:::\n\n\n```{r}\n\ntidy_length %>%\n  filter(!Measurement == \"PCL\") %>%\n  group_by(Species, Measurement) %>%\n  summarize(mean = mean(Length, na.rm = TRUE)) %>%\n  pivot_wider(names_from = \"Measurement\", values_from = \"mean\")\n\n```\n\n\n::: {.callout-note icon=false}\n\n## {{< fa clipboard-question >}}   Give it a whirl\n\nCalculate the number of individuals per species caught per month in 2018 and present that data in a wide formate to make it easy to compare the number of species (species) per month (columns). As a bonus create an additional column with total catch of that species for 2018.\n\n:::\n\n\n::: {.callout-important icon=false}\n\n## {{< fa pen >}}   Did it!\n\n[Your answer here]\n\n:::\n","srcMarkdownNoYaml":"\n\n# Tidy data\n\n```{r}\n#| label: setup\n#| include: false\n\n# set options\nknitr::opts_chunk$set(\n  tidy = FALSE, \n  message = FALSE,\n\twarning = FALSE)\n\noptions(htmltools.dir.version = FALSE)\n\n```\n\n\n**Learning Objectives**\n\nAfter completing this lab you should be able to \n\n* describe what a tidy data set is.\n* use `pivot_longer()` to convert a wide data set to a tidy (long) data set.\n* use `pivot_wider()` to convert a long (tidy) data set to a wide data set.\n\n\nFor each of our modules we will have a project-folder with an `Rproject`, `*.qmd`-files, and sub-directories for data, scripts, and results as described in our `Rproject` Tutorial. You should have a directory on your Desktop or Documents folder on your laptop (name it something like `bi349`) as a home directory for all of our project folders this semester. \n\n[You should have already downloaded the project directory for this module ](https://drive.google.com/drive/folders/1Sh4mtvdii1k_vU4-mfvgIGwJsZvo8MOt?usp=sharing), make sure the directory is unzipped and move it to your `bi328` directory. You can open the `Rproj` for this module either by double clicking on it which will launch `Rstudio` or by opening `Rstudio` and then using `File > Open Project` or by clicking on the `Rproject` icon in the top right of your program window and selecting `Open Project`. \n\nOnce you have opened a project you should see the project name in the top right corner^[Pro tip: If you run into issues where a quarto document won't render or file paths aren't working (especially if things were working previously) one of your first steps should be to double check that the correct `Rproj` is loaded.].\n\nThere should be a document named `09_tidy-data.qmd` in your project directory. Use that file to work through this tutorial - you will hand in your rendered (\"knitted\") `quarto` file as your homework assignment. So, first thing in the `YAML` header, change the author to your name. You will use this `quarto` document to record your answers. Remember to use comments to annotate your code; at minimum you should have one comment per code set^[You should do this whether you are adding code yourself or using code from our manual, even if it isn't commented in the manual... especially when the code is already included for you, add comments to describe how the function works/what it does as we introduce it during the participatory coding session so you can refer back to it.] you may of course add as many comments as you need to be able to recall what you did]. Similarly, take notes in the document as we discuss discussion/reflection questions but make sure that you go back and clean them up for \"public consumption\".\n\nLet's start by loading the packages we will need for this activity.\n\n```{r}\n\n# load libraries\nlibrary(knitr)\nlibrary(tidyverse)\n\n```\n\n## Producing tidy data sets\n\nThe last set of functions that we need to get comfortable with allow us to create tidy data sets. \n\n::: {.callout-note icon=false}\n\n## {{< fa clipboard-question >}}   Consider this\n\nList the three characteristics of a tidy data set. Explain why a tidy data set is sometimes also describe as a long data set.\n\n:::\n\n\n::: {.callout-important icon=false}\n\n## {{< fa pen >}}   Did it!\n\n[Your answer here]\n\n:::\n\nLet's read out data set back into our R session.\n\n```{r}\n\n# read catch data\ncatch <- read_delim(\"data/longline_catchdata.txt\", delim = \"\\t\")\n\n```\n\n::: {.callout-note icon=false}\n\n## {{< fa clipboard-question >}}   Consider this\n\nTake a look at our data set and argue whether or not it is a tidy data set. The easiest way to do this is to determine if it fullfills all the characteristics.\n\n:::\n\n\n::: {.callout-important icon=false}\n\n## {{< fa pen >}}   Did it!\n\n[Your answer here]\n\n:::\n\nLet's quickly reformat our catch data as follows\n\n```{r}\n\ncatch_length <- catch %>%\n  unite(SetID, Year, Month, Day, Set, sep = \"_\") %>%\n  select(SetID, Site, Species, Sex, PCL, FL, STL)\n\nhead(catch_length)\n\n```\n\nWe can turn this into a tidy data set using `pivot_longer()`. To do this we have to identify columns that will be used as the key (`cols = `) and then name the column that will hold those values (`names_to()`) and the column that will hold the value (`values_to()`).\n\nIn this case, we have made three observations about length for each specimen, in order to have rows with unique observations we want a column that identifies what type of observation was made, for example called `Measurement`. This is called the \"key\" because it allows us to \"unlock\" what type of measurement the individual observation is, i.e. this column will let us know whether an observation (row) is pre-caudal length, fork length, or stretch total length.\n\nWe will designate another column `Length` to hold the values for each measurement.\n\nWe can identify the columns that need to be gathered either by name or since we have re-arranged our dataframe so they are the last columns by column number.\n\n```{r}\n\ntidy_length <- catch_length %>%\n  pivot_longer(names_to = \"Measurement\", values_to = \"Length\", cols = 5:7)\n\n```\n\n::: {.callout-note icon=false}\n\n## {{< fa clipboard-question >}}   Consider this\n\nBriefly outline advantages to using tidy data sets.\n\n:::\n\n::: {.callout-important icon=false}\n\n## {{< fa pen >}}   Did it!\n\n[Your answer here]\n\n:::\n\nWith this data set it would be straightforward for us to e.g. calculate mean values for each length measurement by species using `group_by()` and `summarize()`.\n\n```{r}\n\ntidy_length %>%\n  group_by(Species, Measurement) %>%\n  summarize(mean = mean(Length, na.rm = TRUE))\n\n```\n\n\n## Convert a tidy data set to wide format\n\nDespite all the advantages of tidy data sets you can see from the table above that frequently when we are presenting results in a table it may be advantageous in terms of layout to have a non-tidy format. \n\nThis can be done using `pivot_wider()` which works like `pivot_longer()` but in reverse. You designate which column is the key (`names_from = `), i.e. these will become the column names in the new table. Then you need to identify which column in your current data frame contains the values that should be filled out/spread into the columns that will be generated from your key (`values_from =`).\n\nSince we don't have values for precaudal length, we probably want to use `filter()` to remove those rows first.\n\n::: {.column-margin}\n\nMore notes on naming things ... recall, that we said that filenames should not contain spaces or special characters? We set similar rules for naming objects. Well, column names is a similar conundrum. Including spaces or species characters as a column name creates problems when we are using functions like `select()` to subset by column name or `mutate()` to create new columns based on exisiting columns. Similarly, if the column name is a number you will have problems. If you do have unconvential column names you can rename them using `rename()` or you can use backticks and either side of the name to indicate that it is a column name.\n\n:::\n\n\n```{r}\n\ntidy_length %>%\n  filter(!Measurement == \"PCL\") %>%\n  group_by(Species, Measurement) %>%\n  summarize(mean = mean(Length, na.rm = TRUE)) %>%\n  pivot_wider(names_from = \"Measurement\", values_from = \"mean\")\n\n```\n\n\n::: {.callout-note icon=false}\n\n## {{< fa clipboard-question >}}   Give it a whirl\n\nCalculate the number of individuals per species caught per month in 2018 and present that data in a wide formate to make it easy to compare the number of species (species) per month (columns). As a bonus create an additional column with total catch of that species for 2018.\n\n:::\n\n\n::: {.callout-important icon=false}\n\n## {{< fa pen >}}   Did it!\n\n[Your answer here]\n\n:::\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":"html_document","warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":false,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","reference-location":"margin","toc":true,"toc-depth":2,"number-sections":true,"embed-resources":true,"output-file":"09_tidy-data.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","bibliography":["references.bib"],"citation-location":"margin","fig-cap-location":"margin","tbl-cap-location":"margin","theme":"cosmo","toc-location":"left","code-copy":"hover","anchor-sections":true,"editor_options":{"chunk_output_type":"console"}},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}