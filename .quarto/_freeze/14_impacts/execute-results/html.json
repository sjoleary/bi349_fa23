{
  "hash": "9f6ac65060d488ebe1c4c8f895c3f551",
  "result": {
    "markdown": "\n# Climate change: Impacts\n\n\n\n\n\n\n**Learning Objectives**\n\nAfter completing this tutorial you should be able to\n\n* apply the grammar of graphics implemented in `ggplot` to create plots.\n* use core geometries implemented `ggplot` to produce scatter plots (`geom_point()`), line plots (`geom_line()`), bar plots (`geom_bar()`), histograms (`geom_histogram`), and box plots (`geom_boxplot()`).\n* customize aesthetics of a plot, including color and axis labels.\n* describe what faceting is and apply this to a plot.\n* combine multiple plots in a multi-panel plot using `patchwork` and save plots to file.\n\n[You should have already downloaded the directory for this project here](https://drive.google.com/drive/folders/16TMHDkBq3OAVh1LtSJBQYfzUJ4GMA_iD?usp=sharing). You can open the `Rproj` for this module either by double clicking on it which will launch `Rstudio` or by opening `Rstudio` and then using `File > Open Project` or by clicking on the `Rproject` icon in the top right of your program window and selecting `Open Project`. \n\nThere should be a file named `14_impacts.qmd` in that project directory. Use that file to work through this chapter - you will hand in your rendered (\"knitted\") `quarto` file as your homework assignment. So, first thing in the `YAML` header, change the author to your name. You will use this `quarto` document to record your answers. Remember to use comments to annotate your code. Similarly, take notes in the document as we discuss discussion/reflection questions but make sure that you go back and clean them up for \"public consumption\".\n\nBefore you get started, let's make sure to read in all the packages we will need.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load libraries\nlibrary(knitr)\n\nlibrary(ggplot2)\nlibrary(ggthemes)\nlibrary(patchwork)\n\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(readr)\nlibrary(magrittr)\n\n# turn of sci notation\noptions(scipen=999)\n```\n:::\n\n\n\n## A grammar of graphics\n\nNow that we are confident(ish) in our data wrangling the next step is learning how we can visualize our data for exploration and for communication. We have already used figures using custom functions implemented in `DADA2` that are based on the grammar of graphics/wrap functions from `ggplot2` and we also familiarized ourselves with the syntax for using `ggplot2` in the previous chapter.\n\nBeing able to visualize your data is an important skill throughout the process of data science. For example, in our next module we will dig into how to complete an exploratory analysis which is an important component of data science as it not only gives you an overview of what information is contained in a data set and can also help you refine the question you are asking. Finally, once you have refined and completed an analysis, visualizations are a key component to communicate your results.\n\n`ggplot2` is the core package of the `tidyverse` used for visualization. Similar to `tidyr` and `dplyr` having been built on the concept of a tidy data set, `ggplot2` was built on a framework which follows a layered approach to describe and/or build any type of visualization in a structured way termed the \"grammar of graphics\".\n\nThe grammar of graphics breaks down the components of any visualization into seven components.\n\n* **Data** is the component of data set to visualize^[You will see that this is either explicitly specified as the `data` argument (`ggplot(data = df)`), or you can just specify the `data.frame` or `tibble` to plot without typing in `data =` as `ggplot(df)`.].\n* **Mapping** or **Aesthetics** include variables to be plotted, plot positions (e.g. x or y axis), and encodings such as size, shape, color^[These components are specified as the `mapping` argument using `aes()`. Again you can explicitly call the argument as `mapping = `, i.e. `ggplot(data = df, mapping = aes())`, or you can just specify the mapping aesthetics using `aes()` because you are using the arguments in the correct sequence `(ggplot(df, aes()))` in which case `R` assumes they apply to these various arguments.].\n* **Geometric objects** (or layers) are what you actually end up seeing in the visualization, e.g. points, lines, bars etc. to represent data. This can also include statistical transformations^[Functions for these geometric objects will all start with `geom_*` or `stat_*`].\n* **Scale**s map the values in the aesthetic space you specified, this includes your scales for color, shape, and size, you can also explicitly specify scales for the x and y axis.\n* **Coordinate system**, includes all the usual suspects such as cartesian or polar along with some you may have never really heard of.\n* **Facets**, i.e. subplots based on multiple dimensions.\n* **Statistics**, including confidence intervals, means, quantiles, may additionally be added to the plot.\n\nAdditionally, you can create and use **themes** that control additional aspects of your your figure is displayed including font size, background color, etc.^[The package `ggthemes` includes various themes but you will also find that you can create your custom themes in a pretty straightforward way and that many `R` users have creted themes that they have made accessible for other users.].\n\nUntil now you've probably thought of each plot type as it's own distinctive format (a scatter plot, a pie chart, etc) and have not considered that each plot can be broken down into these fundamental components, so at first this way of thinking of plots will likely not seem intuitive. \n\nBut if you commit to thinking about plots in this abstract way you will quickly learn how these components fit together and realize the flexibility that this framework will give you to quickly generate exploratory plots, optimize your visualizations and be able to generate pretty much any plot you can think up^[You will also see that keeping your data `tidy` will allow you to customize your plots using different aesthetics and mappings to group your data.].\n\n\n## Building plots\n\nY'all ready for this? \n\nThen, let's go back to our global mean temperature anomaly data set to figure out how the grammar of graphics can be applied and plot some data!\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntemperature <- read_delim(\"data/GLB.Ts+dSST.csv\", delim = \",\", skip = 1) %>%\n  replace(. == \"***\", NA) %>%\n  mutate_if(is.character, as.numeric)\n```\n:::\n\n\nRecall how we created a line plot:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(temperature, aes(x = Year, y = `J-D`)) +\n  geom_line()\n```\n\n::: {.cell-output-display}\n![](14_impacts_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nWe can generalize this into a basic template that can be used for different kinds of plots, including scatter plots, bar plots, and box plots.\n\n```\n\nggplot(data = <DATA>, mapping = aes(<MAPPINGS>)) +\n  <GEOM_FUNCTION>\n\n```\n\nEssentially, the minimum components needed to make a plot are \n\n1. A **data set** (`<DATA>`), this will be a `data.frame` or a `tibble`^[Remember, when we use `read_delim()` our data is automatically a object both of the format `tibble` and `data.frame`; while a `tibble` has some additional properties but we can use them interchangeably].\n2. Based on the data, we need to define what **variables** we are going to plot (`<MAPPINGS>`) and how we want them to be represented, i.e. what individual data points should look like and how they are encoded.\n3. We need to define the **geometries**, i.e. what type of plot (`<GEOM_FUNCTION`). \n\nLet's break down what is happening to get a better understanding of how these minimum components fit together to create individual plots.\n\nFirst, we use the `ggplot()` function to define the specific `data.frame` to use to build the plot using the `data` argument (`<DATA>`)^[Remember, that when we are using arguments in the specified sequence that they are defined you do not explicitly need to call them.].\n\nIn our example that would be\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = temperature)\n```\n\n::: {.cell-output-display}\n![Empty canvas generated using ggplot() function.](14_impacts_files/figure-html/fig-empt-1.png){#fig-empt width=672}\n:::\n:::\n\n\nNot much happens when you execute that piece of code other than creating a blank canvas in your plot panel^[Remember, if you are using and `Rmarkdown`  or `quarto` document and have `Chunk Output Inline` enabled it will print beneath your code chunk]. \n\nThat is because we still need to define an aesthetic mapping using the `aes()` function (`<MAPPING>`). \n\nHere, we are selecting the variables that we want to plot (columns in our `data.frame`). At minimum we need to specify what columns we want to plot on the x and y axis, but we can also define variables (columns) we want to use to encode using color, shapes, size etc.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = temperature, aes(x = Year, y = `J-D`))\n```\n\n::: {.cell-output-display}\n![Coordinate system plotted after specifying mapping aesthetics, specifically which variables to plot on each axis.](14_impacts_files/figure-html/fig-aes-1.png){#fig-aes width=672}\n:::\n:::\n\n\nWhen we execute that code you will now get an empty coordinate system. This still seems like slim pickings but patience, young grasshopper, we have not yet defined the `geom`, i.e. what type of plot (\"geometries\", `<GEOM_FUNCTION>`) we want to use. For example, here we want generate a line plot (`geom_line()`).\n\n::: {.column-margin}\n\nFor `ggplot` we add layers using the `+` operator, which is a pipe (similar to `%>%`) which tells `R` \"and now add this\".\n\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = temperature, aes(x = Year, y = `J-D`)) +\n  geom_line()\n```\n\n::: {.cell-output-display}\n![Line plot (geom_line()) showing global mean temperature anomalies relative to 1951-1980 average.](14_impacts_files/figure-html/fig-geom_line-1.png){#fig-geom_line width=672}\n:::\n:::\n\n\nNow, we're playing!\n\nOne of the advantages of the layered framework of `ggplot2` is that we can plot multiple layers in the same plot by adding additional `geoms`. \n\nFor example, we can plot a scatterplot and line plot in the same plot as such:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = temperature, aes(x = Year, y = `J-D`)) +\n  geom_line() +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![Line plot showing global mean temperature anomalies relative to 1951-1980 average. Individual data points added using geom_point().](14_impacts_files/figure-html/fig-layers-1.png){#fig-layers width=672}\n:::\n:::\n\n\nNow that you know how to generate a simple plot, let's think about how we can further modify it to improve your visualization and how well you can communicate your results.\n\nFor example, we can change the color, fill, size, and shape for each `geom` layer.\n\n::: {.column-margin}\n\nIn this example we are using the arguments for individual geom functions to change how data points are represented using colors and shapes for each layer, we can also use `aes()` to set mapping aesthetics for the entire plots.\n\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = temperature, aes(x = Year, y = `J-D`)) +\n  geom_line(color = \"darkblue\", size = 1) +\n  geom_point(shape = 21, color = \"darkblue\", fill = \"white\", size = 3)\n```\n\n::: {.cell-output-display}\n![Line plot showing global mean temperature anomalies relative to 1951-1980 average. Individual data points added using geom_point(), color and fill for lines and shapes have been modified.](14_impacts_files/figure-html/fig-color-1-1.png){#fig-color-1 width=672}\n:::\n:::\n\n\nShapes for points can be specified using numbers; note how some shapes are \"solid\", i.e. specifying `color` will define the color of the shape. Others, like the one used in our example are filled, i.e. `color` will determine the color of the outline, and `fill` the color of the space inside. For \"hollow\" shapes (or e.g. X's) `color` will determine the line color.\n\n![Numeric codes for sympols.](images/points-symbols.png){width=50%}\n\nYou can specify colors either using [the color names defined by R](http://applied-r.com/r-color-tables/)  or using hex codes. \n\n::: {.column-margin}\n\nSome exploring will also lead you to various color pallets, many of them put together by `R` users around the world. Wes Anderson fan? You can [style your plots](https://github.com/karthik/wesanderson) accordingly... dig the aesthetics of the old school National Park posters and images? [R community got you covered.](https://github.com/katiejolly/nationalparkcolors).\n\n:::\n\nPreviously, we also used `geom_smooth()` to add a layer with a linear regression. If you take a look at the arguments for this function using `?geom_smooth` you will see that this has additional arguments apart from the mapping aesthetics like choosing the type of regression, whether or not the confidence interval is shown etc. Let's say we want to add a red, dashed regression line without the confidence interval.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = temperature, aes(x = Year, y = `J-D`)) +\n  geom_line(color = \"darkblue\", size = 1) +\n  geom_point(shape = 21, color = \"darkblue\", fill = \"white\", size = 3) +\n  geom_smooth(stat = \"smooth\", se = FALSE, color = \"red\", linetype = \"dashed\", size = 2)\n```\n\n::: {.cell-output-display}\n![Line plot showing global mean temperature anomalies relative to 1951-1980 average. Individual data points added using geom_point(), color and fill for lines and shapes have been modified. Trend line fitted using geom_smooth().](14_impacts_files/figure-html/fig-geom_smooth-1.png){#fig-geom_smooth width=672}\n:::\n:::\n\n\nAdmittedly, this plot is now starting to look a little bit ridiculous and is probably make it less, not more easy for the viewer to undestand what they can learn from the data. Maybe we should think of alternative options for visualizing this data to explore some additional `ggplot` options.\n\nAnother way to visualize this data would be using a bar plot.\n\n::: {.column-margin}\n\nCan we appreciate for a second how easy it was to change how the same data is plotted? If you were using excel you would have had to insert a new plot, define what data you wanted to plot, relabel the axis, etc. Here all you had to do was change a single line of code.\n\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = temperature, aes(x = Year, y = `J-D`)) +\n  geom_bar(stat = \"identity\")\n```\n\n::: {.cell-output-display}\n![Bar plot showing global mean temperature anomalies relative to 1951-1980 average.](14_impacts_files/figure-html/fig-bar-1.png){#fig-bar width=672}\n:::\n:::\n\n\nNotice, how this is still the exact same mapping aesthetics (time/year on the x-axis and the temperature anomaly on the y-axis) but it changes the way we see the data completely - the emphasis now is on the change of temperatures below or above the long-term mean and the clear pattern of a shift of those temperature differences going from negative to being positive.\n\nLet's say we want really lean into demonstrating this drastic change in temperatures not only being above the long-term average but also steadily increasing. One way to do this is to use color. We could modify this bar plot to have all of our bars representing years with global mean temperatures below the 1951-1980 average in one color and those above in another. \n\nTo do this, we need a column that encodes that information... that of course is not an issue for us as pretty much professional data wranglers! We can use a simple conditional mutate using an `ifelse()`^[recall, that we previously used `case_when()` for a conditional mutate, when the condtion is binary (true/false or this/that) using `ifelse()` makes for a much shoerte syntax.] statement to add a column (`year_type`) that indicates whether temperatures are above or below the the long-term average.\n\nWe can manipulate our `data.frame` using the `dplyr` functions we are already familiar with. We can even use the `%>%` pipe to pass the data argument directly to the `ggplot()` function^[When you do this, remember that you need to switch back to using the `+` operator once you are adding your geom layers.]\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntemperature %>%\n  mutate(year_type = ifelse(`J-D` <=0, \"colder\", \"hotter\")) %>%\n  ggplot(aes(x = Year, y = `J-D`, fill = year_type, color = year_type)) +\n  geom_bar(stat = \"identity\")\n```\n\n::: {.cell-output-display}\n![Bar plot showing global mean temperature anomalies relative to 1951-1980 average. Mapping aesthetics have been specified to color code according to variable included in the data set.](14_impacts_files/figure-html/fig-color-2-1.png){#fig-color-2 width=672}\n:::\n:::\n\n\nAnything that we add to the `ggplot()` layer as a mapping is a universal plot setting that will apply to all subsequent layers. You can override these global settings is you specify aesthetics like color, shape or size specifically in an separate layer. For example if we do the following, we will override our color coding even though we specified it in our `ggplot()` layer.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntemperature %>%\n  mutate(year_type = ifelse(`J-D` <=0, \"colder\", \"hotter\")) %>%\n  ggplot(aes(x = Year, y = `J-D`, fill = year_type, color = year_type)) +\n  geom_bar(stat = \"identity\", color = \"blue\", fill = \"blue\")\n```\n\n::: {.cell-output-display}\n![Bar plot showing global mean temperature anomalies relative to 1951-1980 average. Mapping aesthetics have been specified to color code according to variable included in the data set. Settings in geom_bar() override the general plot specifications.](14_impacts_files/figure-html/fig-layers-matter-1.png){#fig-layers-matter width=672}\n:::\n:::\n\n\nLet's see what else we can visualize using `ggplot`. Recall from when you explored our temperature anomaly data set, that this data set also contains information for seasons and individual months.\n\nLet's take a look at the distribution of mean global winter temperatures (`DJF` = December, January, February) using a histogram, (`geom_histogram()`). Note that we only need to define our x-axis to plot a histogram, this is because `ggplot2` will count how many observations fall into each bin for you ... this geom is a mixture of a geometry (bar plot) and a statistical transformation (binning data points into ranges and the plotting those as bar plots).].\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(temperature, aes(x = DJF)) +\n  geom_histogram()\n```\n\n::: {.cell-output-display}\n![Histogram summarizing the distribution of mean global winter temperatures.](14_impacts_files/figure-html/fig-mean-glob-wint-1.png){#fig-mean-glob-wint width=672}\n:::\n:::\n\n\nWe can refine our plot by choosing our own bin width and by manipulating fill and color.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(temperature, aes(x = SON)) +\n  geom_histogram(binwidth = 0.05, color = \"black\", fill = \"darkorange\")\n```\n\n::: {.cell-output-display}\n![Histogram displaying distribution of mean global winter temperatures with customized bin width and coloration.](14_impacts_files/figure-html/fig-histog-color-1.png){#fig-histog-color width=672}\n:::\n:::\n\n\nFor our example we might also want to add a vertical line (`geom_vline()`) to indicate 0 (i.e. the long-term global temperature mean calculated for 1951 - 1980).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(temperature, aes(x = SON)) +\n  geom_histogram(binwidth = 0.05, color = \"black\", fill = \"darkorange\") +\n  geom_vline(xintercept = 0, color = \"darkred\", linetype = \"dashed\", size = 1)\n```\n\n::: {.cell-output-display}\n![Histogram displaying distribution of mean global winter temperatures with customized binwidth and coloration and added vertical line (red).](14_impacts_files/figure-html/fig-custim-bin-widtg-1.png){#fig-custim-bin-widtg width=672}\n:::\n:::\n\n\nIf we want to compare multiple distributions, box plots can be more helpful than histograms. Let's say we wanted to compare the distribution of mean global temperature for each season.\n\nHow can we go about this?\n\nCurrently, our seasons are in individual columns, so our first step would be to create a tidy data set.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntidy_season <- temperature %>%\n  select(Year, DJF, MAM, JJA, SON) %>%\n  pivot_longer(names_to = \"season\", values_to = \"temperature\", 2:5)\n```\n:::\n\n\nNow we can plot our seasons on the x-axis and the distribution of temperatures on the y-axis using `geom_boxplot()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(tidy_season, aes(x = season, y = temperature)) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![Box plot comparing global mean temperature anomalies relative to 1951-1980 average for all four seasons.](14_impacts_files/figure-html/fig-boxplot-1.png){#fig-boxplot width=672}\n:::\n:::\n\n\nAgain, you can add additional information using the mapping aesthetics to e.g. color code the boxes by season.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(tidy_season, aes(x = season, y = temperature, fill = season)) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![Box plot comparing global mean temperature anomalies relative to 1951-1980 average for all four seasons color-coded by season.](14_impacts_files/figure-html/fig-boxplot-modified-1.png){#fig-boxplot-modified width=672}\n:::\n:::\n\n\n\n## Faceting plots\n\nOne of the advantages of `ggplot2` being based not only on the grammar of graphics but also around the concept of a tidy data set is being able to create faceted plots. A faceted plot involves splitting a single plot into a matrix of panels, where each panel shows a different subset of the data. This is especially helpful during exploratory analysis where you might first plot all your data points in a single graph but then want to look at whether or not individual subsets within the data set behave the same.\n\nLet's look at an example to better understand what faceting plots looks like. For example, let's say we wanted to create individual plots of our bar plots showing our deviations of global temperatures from the 1951 - 1980 mean for each season.\n\nHow could you create individual plots with the methods you are already familiar with?\n\nHere is how you can do it using `facet_grid()`.\n\nNow we can plot our data and using `facet_grid()` we can specify that we want individual panels by month in separate rows.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(tidy_season, aes(x = Year, y = temperature)) +\n  geom_bar(stat = \"identity\", fill = \"darkorange\", color = \"darkorange\") +\n  facet_grid(rows = vars(season))\n```\n\n::: {.cell-output-display}\n![Change in temperature anomaly relative to long-term avarage per season (rows)](14_impacts_files/figure-html/fig-facts-rows-1.png){#fig-facts-rows width=672}\n:::\n:::\n\n\nYou could also specify that you want the individual plots to be separated into columns.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(tidy_season, aes(x = Year, y = temperature)) +\n  geom_bar(stat = \"identity\", fill = \"darkorange\", color = \"darkorange\") +\n  facet_grid(cols = vars(season))\n```\n\n::: {.cell-output-display}\n![Change in temperature anomaly relative to long-term avarage per season (columns)](14_impacts_files/figure-html/fig-facet-col-1.png){#fig-facet-col width=672}\n:::\n:::\n\n\nYou can also create faceted plot where subset your data by two variables and so you end up with one variable defining the rows and one the columns and you can use a simpler syntax `row-variable ~ column-variable`.\n\nYou can also use this syntax if you are only faceting by one variable as we are doing in this example by specifying the variable and leaving the other one \"blank\" using a `.`.\n\nFor example, to plot this faceted data set in rows, you would use the following syntax - \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(tidy_season, aes(x = Year, y = temperature)) +\n  geom_bar(stat = \"identity\", fill = \"darkorange\", color = \"darkorange\") +\n  facet_grid(season ~ .)\n```\n\n::: {.cell-output-display}\n![Change in temperature anomaly relative to long-term avarage per season (rows)](14_impacts_files/figure-html/fig-facet-row-2-1.png){#fig-facet-row-2 width=672}\n:::\n:::\n\n\nAnd to plot this data set column-wise you would specify it like so -\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(tidy_season, aes(x = Year, y = temperature)) +\n  geom_bar(stat = \"identity\", fill = \"darkorange\", color = \"darkorange\") +\n  facet_grid(. ~ season)\n```\n\n::: {.cell-output-display}\n![Change in temperature anomaly relative to long-term avarage per season (columns)](14_impacts_files/figure-html/fig-facet-col-2-1.png){#fig-facet-col-2 width=672}\n:::\n:::\n\n\n\n## Customizing plots\n\nWe have already played around a little bit with the options that we have in terms of customizing plots using color, fill, shapes, and sizes. But we've barely scratched the surface.\n\nYou have probably noticed that there are some default settings like the gray background and white grid lines, font sizes of label axis, what the axis labels are, and even color schemes that are automatically used. Even using the defaults we get pretty clean plots that are visually appealing. This is super helpful during exploratory analysis because even though you playing around with the data you still have nicely formatted and easy to interpret figures.\n\nOnce you have identified the central plots that you want to use to communicate the results and conclusions of your data analysis you will want to further customize your visualization to optimize communication, this includes how you encode data using color and shape but also making sure that everything is well labeled and clear to the person who is reading your report or listening to your presentation.\n\nOne of the first things we frequently want to changes is the axis labels. `ggplot2` does handily use the column names to automatically label your axes, so you will always have a label which is great during exploratory analysis but generally you will want to customize that for your final figure. The function `labs()` can be used to specify a title, subtitle, axis labels and additional annotations (caption) below the figure.\n\nFor example we could customize our faceted figure to look like this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(tidy_season, aes(x = Year, y = temperature)) +\n  geom_bar(stat = \"identity\", fill = \"darkorange\", color = \"darkorange\") +\n  facet_grid(rows = vars(season)) +\n  labs(title = \"Change in global seasonal temperatures 1880 - 2020\",\n       subtitle = \"Global mean temperatures relative to 1951 - 1980 mean\",\n       x = \"Year\", y = \"Temperature [C]\",\n       caption = \"Date source: NASA Goddard Institute for Space Studies\")\n```\n\n::: {.cell-output-display}\n![Change in temperature anomaly relative to long-term avarage per season (rows)](14_impacts_files/figure-html/fig-customize-1.png){#fig-customize width=672}\n:::\n:::\n\n\nPretty much every component of a `ggplot` figure can be further customized using `theme()`, this includes things like font size, background and line colors, grids, legend position ... `ggplot2` odes have some pre-defined themes that you can call up that will change the layout. \n\nThe default theme is `theme_grey()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(tidy_season, aes(x = Year, y = temperature)) +\n  geom_bar(stat = \"identity\", fill = \"darkorange\", color = \"darkorange\") +\n  facet_grid(rows = vars(season)) +\n  labs(title = \"Change in global seasonal temperatures 1880 - 2020\",\n       subtitle = \"Global mean temperatures relative to 1951 - 1980 mean\",\n       x = \"Year\", y = \"Temperature [C]\",\n       caption = \"Date source: NASA Goddard Institute for Space Studies\") +\n  theme_grey()\n```\n\n::: {.cell-output-display}\n![Change in temperature anomaly relative to long-term avarage per season (rows)](14_impacts_files/figure-html/fig-theme-1.png){#fig-theme width=672}\n:::\n:::\n\n\nHere, we explicitly specified it using `theme_grey()`; if you do not specify a theme this is the theme that will be used for your plot. There are other themes that are part of the `ggplot` package that include `theme_bw()`, `theme_minimal()`, `theme_classic()` or `theme_light()`.\n\n::: {.callout-note icon=false}\n\n## {{< fa clipboard-question >}}   Give it a whirl\n\nRe-plot the same figure using the four themes specified above.\n\n:::\n\n\n::: {.callout-important icon=false}\n\n## {{< fa pen >}}   Did it!\n\n[Your answer here]\n\n:::\n\nYou will likely find a theme that you like but still want or need to make additional tweaks. In that case the function `theme()` is your friend. \n\nLet's go back to our bar plot of the global temperature anomaly to look at an example of likely the three most common things you will want to adjust which is the legend position, changing font size, color, turning x-axis labels by 90 degrees.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntemperature %>%\n  mutate(year_type = ifelse(`J-D` <=0, \"colder\", \"hotter\")) %>%\n  ggplot(aes(x = Year, y = `J-D`, fill = year_type, color = year_type)) +\n  geom_bar(stat = \"identity\") +\n  labs(title = \"Change in global mean temperatures 1880 - 2020\",\n       subtitle = \"Global mean temperatures relative to 1951 - 1980 mean\",\n       x = \"Year\", y = \"Temperature [C]\",\n       caption = \"Date source: NASA Goddard Institute for Space Studies\") +\n  theme_classic() +\n  theme(legend.position = \"bottom\",\n        axis.text.x = element_text(size = 12, color = \"black\",\n                                   angle = 90, hjust = 0.5, vjust = 0.5),\n        axis.text.y = element_text(size = 12, color = \"black\",),\n        axis.title = element_text(size = 14))\n```\n\n::: {.cell-output-display}\n![Change in mean global temperature relative to long-term avaerage with customized font sizes and legend positions.](14_impacts_files/figure-html/fig-customize-theme-1.png){#fig-customize-theme width=672}\n:::\n:::\n\n\nThat's starting to look pretty slick.\n\nAs you start your visualization adventure the [R Cookbook](https://www.cookbook-r.com/Graphs/Colors_(ggplot2)/) is a good resource. It is written in a helpful style that starts with a concrete plotting problem and then walks you through a solution.\n\n\n## Arranging plots\n\nWe've already seen that we can create multi-panel plots in a very straightforward way when we are plotting the same plot for different subsets of the data (facetted plots).\n\nBut what if we want to generate individual plots that might fit together thematically but aren't subsets that we can facet but we still want to be able to present them together? Fear not, this too can be solved; one option is using `patchwork`, a package designed for exactly this purpose. Let's generate a few additional plots so we can try this out.\n\nIn our data folder there is a tab-delimited file with monthly mean CO2 concentrations (parts per million) from Maunua Loa. Let's read in that data set and create line plot with a regression line.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncarbon <- read_delim(\"data/CO2_monthly.txt\", delim = \"\\t\")\n\nggplot(carbon, aes(x = date, y = average)) +\n  geom_line(color = \"blue\") +\n  geom_smooth(color = \"red\") +\n  labs(title = \"Atmospheric CO2\",\n       subtitle = \"monthly mean CO2 Mauna Loa CO2\",\n       x = \"year\", y = \"CO2 concentration air [ppm]\",\n       caption = \"Data: NOAA/ESRL\") +\n  theme_classic()\n```\n\n::: {.cell-output-display}\n![Mean monthly atmospheric CO2 concentrations measuread at Mauna Loa Observatory from 1958 - 2021.](14_impacts_files/figure-html/fig-co2-1.png){#fig-co2 width=672}\n:::\n:::\n\n\nWe also have a data set from the Global Carbon Project downloaded from the [Our World in Data repository](https://github.com/owid/co2-data) that contains atmospheric CO2 emissions. We can plot that as a simple line plot with a regression.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemissions <- read_delim(\"data/emissions.txt\", delim = \"\\t\") %>%\n  filter(iso_code == \"OWID_WRL\")\n\nggplot(emissions, aes(x = year, y = co2)) +\n  geom_line(color = \"blue\", size = 1) +\n  geom_smooth(color = \"red\") +\n  labs(title = \"CO2 Emissions over time.\",\n       subtitle = \"Global emissions atmospheric emissions by year.\",\n       x = \"year\", y = \"CO2 [Gt/year]\",\n       caption = \"Data: Global Carbon Project/Our World in Data\") +\n  theme_classic()\n```\n\n::: {.cell-output-display}\n![Global atmospheric CO2 emissions.](14_impacts_files/figure-html/fig-glob-co2-emissions-1.png){#fig-glob-co2-emissions width=672}\n:::\n:::\n\n\nTo be able to plot multiple plots in one using `patchwork` we need to assign our figures as objects.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- ggplot(carbon, aes(x = date, y = average)) +\n  geom_line(color = \"blue\") +\n  geom_smooth(color = \"red\") +\n  labs(title = \"Atmospheric CO2\",\n       subtitle = \"monthly mean CO2 Mauna Loa CO2\",\n       x = \"year\", y = \"CO2 concentration air [ppm]\",\n       caption = \"Data: NOAA/ESRL\") +\n  theme_classic()\n\np2 <- ggplot(emissions, aes(x = year, y = co2)) +\n  geom_line(color = \"blue\", size = 1) +\n  geom_smooth(color = \"red\") +\n  labs(title = \"Atmospheric CO2 Emissions\",\n       subtitle = \"global emissions\",\n       x = \"year\", y = \"CO2 [Gt/year]\",\n       caption = \"Data: Global Carbon Project/Our World in Data\") +\n  theme_classic()\n```\n:::\n\n\nNow we can combine them side by side using a simple syntax.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 + p2\n```\n\n::: {.cell-output-display}\n![Mean monthly atmospheric CO2 concentrations measuread at Mauna Loa Observatory (left panel) and Global atmospheric CO2 emissions (right panel).](14_impacts_files/figure-html/fig-patchwork-1-1.png){#fig-patchwork-1 width=672}\n:::\n:::\n\n\nSimilarly, we can plot them underneath each other like so -\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 / p2\n```\n\n::: {.cell-output-display}\n![Mean monthly atmospheric CO2 concentrations measuread at Mauna Loa Observatory (top panel) and Global atmospheric CO2 emissions (bottom panel).](14_impacts_files/figure-html/fig-patchwork-2-1.png){#fig-patchwork-2 width=672}\n:::\n:::\n\n\nOh, it gets better. Let's say we wanted to plot our global mean temperatures in the top row and our two emissions plots below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np3 <- temperature %>%\n  mutate(year_type = ifelse(`J-D` <=0, \"colder\", \"hotter\")) %>%\n  ggplot(aes(x = Year, y = `J-D`, fill = year_type, color = year_type)) +\n  geom_bar(stat = \"identity\") +\n  labs(title = \"Change in global mean temperatures 1880 - 2020\",\n       subtitle = \"Global mean temperatures relative to 1951 - 1980 mean\",\n       x = \"Year\", y = \"Temperature [C]\",\n       caption = \"Date source: NASA Goddard Institute for Space Studies\") +\n  theme_classic() +\n  theme(legend.position = \"bottom\",\n        axis.text.x = element_text(size = 12, color = \"black\",\n                                   angle = 90, hjust = 0.5, vjust = 0.5),\n        axis.text.y = element_text(size = 12, color = \"black\",),\n        axis.title = element_text(size = 14))\n\np3 / (p1 | p2)\n```\n\n::: {.cell-output-display}\n![Comparison of change in mean global temperature (top panel), atmospheric CO2 concentrations (bottom left), and atmospheric CO2 emissions (bottom right).](14_impacts_files/figure-html/fig-patchwork-3-1.png){#fig-patchwork-3 width=672}\n:::\n:::\n\n\nYou can create complex compositions in `patchwork` using syntax combining `+`, `|`, and `\\`. To see how you can control the layout even further you can check out the [documentation for patchwork](https://patchwork.data-imaginist.com/articles/guides/layout.html).\n\n\n## Exporting Plots\n\nThe last thing we still have to figure out is how to save plots to file. You have a few options.\n\nThe quickest and dirtiest option is to simply right click on the plot pane after plotting a figure and then save the figure using `Save image as`. This works and is easy to do but gives you very little control over the dimensions, resolution, file format etc.\n\nFor more control over the format of your figure you can use the Export tab in the Plot pane which will allow you to adjust the dimensions and the the file format.\n\nFinally, the `ggplot2` has a function called `ggsave()` that will allow you to determine the dimensions (`width`, `height`), resolution (`dpi`), and format (`device`).\n\nBy default it will save the last plot that was plotted. If you specify the format in the file name (e.g. `*.svg`, `*.jpg`, `*.png`) it will automatically recognize the format^[Remember that we have designed our research compendium to keep raw and processed data, and results separate? Figures are considered results so you should always save them to the `results` folder.].\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntemperature %>%\n  mutate(year_type = ifelse(`J-D` <=0, \"colder\", \"hotter\")) %>%\n  ggplot(aes(x = Year, y = `J-D`, fill = year_type, color = year_type)) +\n  geom_bar(stat = \"identity\") +\n  labs(title = \"Change in global mean temperatures 1880 - 2020\",\n       subtitle = \"Global mean temperatures relative to 1951 - 1980 mean\",\n       x = \"Year\", y = \"Temperature [C]\",\n       caption = \"Date source: NASA Goddard Institute for Space Studies\") +\n  theme_classic() +\n  theme(legend.position = \"bottom\",\n        axis.text.x = element_text(size = 12, color = \"black\",\n                                   angle = 90, hjust = 0.5, vjust = 0.5),\n        axis.text.y = element_text(size = 12, color = \"black\",),\n        axis.title = element_text(size = 14))\n\nggsave(\"results/global_temp.png\", dpi = 300, width = 15, height = 10)\n```\n\n::: {.cell-output-display}\n![Change in mean global temperature realtive to long-term average.](14_impacts_files/figure-html/fig-save-1.png){#fig-save width=672}\n:::\n:::\n\n\nCheck your results folder to see if you were successful!\n\nIf you assign your plot to an object you can use the `plot` argument of the `ggsave()` function to export it. This also works for figures that consist of multiple panels combined using `patchwork`.\n\n\n## More Plots!\n\nReady to take the training wheels off? \n\nIncreasing global temperatures are effecting change across the different components of the climate system. There are several data sets in your `data` folder. Read in each data set as a data frame, use `View()` to take a look at what information is contained in the data set and the use your new found visualization skills to plot the data using `ggplot`.\n\nWe have looked at rising mean global temperatures and discovered that rapidly increasing emissions and atmospheric concentrations of CO2 are consistent with increased concentrations of greenhouse gases driving temperature change.\n\nThe effects of global warming are observed throughout components of the climate system including the atmosphere, the hydrosphere (marine and freshwater systems), cryosphere (land and sea ice), and lithosphere (earth's surface/crust). Let's look at a few data sets that illustrate the impact of rising temperatures.\n\nFor all the plots, comment each line of your ggplot code (you can add comments between the lines or at the end), remember to caption your figure, list your data source and and label your axis in a meaningful way.\n\n::: {.callout-note icon=false}\n\n## {{< fa clipboard-question >}}   Give it a whirl\n\n\nIncreasing atmospheric temperatures result in land ice melting and the ocean heat content rising. The latter leads to thermal expansion which together with the increase freshwater inflow results in rising sea levels.\n\nThe first data set is from the NOAA Laboratory for Satellite Altimetry and contains records from coastal sea level tide gauges. Start by reading in the data set:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsealevel <- read_delim(\"data/sealevel.txt\", delim = \"\\t\")\n```\n:::\n\n\n1. Take a quick look at the data set using `View()` and briefly summarize what data is contained in this data set^[Include things like the number of columns, what data is contained in each sample, what time periods are included etc. Practice deducing these types of things from the context of the data set description above and by browsing the content.]\n2. Plot the change in mean sea level over time as a line plot and color code the line(s) by method (see column names). Chose a theme and position your legend below the figure. \n3. Figure out how to use `geom_hline()` to add a line at 0.\n4. Comment each line of your ggplot code (you can add comments between the lines or at the end), remember to caption your figure, list your data source and and label your axis in a meaningful way.\n5. Write a short description of your figure summarizing the key results displayed.\n\n:::\n\n\n::: {.callout-important icon=false}\n\n## {{< fa pen >}}   Did it!\n\n**Data Set**:\n\n\n\n**Plot**\n\n\n\n**Summary of results**\n\n\n\n\n:::\n\n\n::: {.callout-tip icon=false collapse=true}\n\n## {{< fa person-chalkboard >}}    Pointers\n\nHere's an example of what tour final figure could look like.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](14_impacts_files/figure-html/unnamed-chunk-35-1.png){width=672}\n:::\n:::\n\n\n:::\n\n\n::: {.callout-note icon=false}\n\n## {{< fa clipboard-question >}}   Give it a whirl\n\nOur next data set is from the [National Snow and Ice Data Center](https://nsidc.org/data/seaice_index/archives) and contains the Arctic (Northern Hemisphere) July sea ice extent.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nice_arctic <- read_delim(\"data/arctic_ice.txt\", delim = \"\\t\")\n```\n:::\n\n\n1. Take a quick look at the data set using `View()` and briefly summarize what data is contained in this data set. Be specific.\n2. Plot the change in ice extent over time as a line plot. Chose a theme. Add a linear regression and confidence interval.\n3. Extra Challenge: Change the default colors of the regression line and the confidence interval.\n4. Comment each line of your ggplot code (you can add comments between the lines or at the end), remember to caption your figure, list your data source and and label your axis in a meaningful way.\n5. Write a short description of your figure summarizing the key results displayed.\n\n:::\n\n\n::: {.callout-important icon=false}\n\n## {{< fa pen >}}   Did it!\n\n**Data Set**:\n\n\n\n**Plot**\n\n\n\n**Summary of results**\n\n\n\n\n:::\n\n\n\n::: {.callout-note icon=false}\n\n## {{< fa clipboard-question >}}   Give it a whirl\n\nLet's take a look at the equivalent data set depicting sea ice extent in the Antarctic (Southern Hemisphere.)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nice_arctic <- read_delim(\"data/antarctic_ice.txt\", delim = \"\\t\")\n```\n:::\n\n\n1. Take a quick look at the data set using `View()` and briefly summarize what data is contained in this data set. Be specific.\n2. Plot the change in ice extent over time as a line plot. Chose a new theme from what you've been using previously. Add a linear regression and confidence interval. \n3. Extra Challenge: Change the default colors of the regression line and the confidence interval.\n4. Comment each line of your ggplot code (you can add comments between the lines or at the end), remember to caption your figure, list your data source and and label your axis in a meaningful way.\n5. Write a short description of your figure summarizing the key results displayed.\n\n:::\n\n\n::: {.callout-important icon=false}\n\n## {{< fa pen >}}   Did it!\n\n**Data Set**:\n\n\n\n**Plot**\n\n\n\n**Summary of results**\n\n\n\n:::\n\n\n\n::: {.callout-note icon=false}\n\n## {{< fa clipboard-question >}}   Give it a whirl\n\nOne more data set. This one is from the NOAA Hurricane Research Division. While interpreting the observed patterns in sea level and ice extent and modeling future projections is pretty straightforward, understanding whether extreme events are getting \"worse\" is a little bit more complicated^[We will take a closer look at this aspect when we combine our data wrangling and visualization skills to learn how to perform an exploratory analysis].\n\nNote: For this coding challenge you will need to combine your data wrangling and visualization skills!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhurricane <- read_delim(\"data/hurricanes.txt\", delim = \"\\t\")\n```\n:::\n\n\nTake a quick look at the data set using `View()` and briefly summarize what data is contained in this data set. Be specific^[Note, several of the columns start with 'Revised' this just has to do with the entire data set having revised (most recent) definitions applied for the metrics included. You can ignore that component.].\n\n**Plot 1**:\n\nWhen thinking about hurricanes there are two metrics to consider when determining whether or not \"hurricanes have gotten worse\". First, we can look at whether or not hurricanes have become more common by plotting the number of hurricanes for each year. \n\n1. Create a faceted plot with individual line plots showing the number of named storms (this would include not only hurricanes put also tropical storms), the number of hurricanes, the number of major hurricanes, and the number of hurricanes in the United States. \n2. Add a linear regression. \n3. Chose a custom theme. \n\n::: {.column-margin}\n\nYou will have to reformat the data set in order to plot it in this fashion. It can be helpful to first think about what your `ggplot` code should look like to create the plot described above and then format your data set to fit those needs. Recall that ggplot is designed not only around the grammar of graphics but also the principles of tidy data... so, do we currently have a tidy data set? Or what would it need to look like for this plotting challenge?. \n\n:::\n\n4. Extra Challenge: We've previously used `facet_grid()` to create faceted plots which requires us to specify how panels should be laid out in rows and/or columns. Figure out how to use `facet_wrap()` to just specify which variable to use to create individual panels with out them all needing to be laid out next to each other in columns or underneath each other in rows. \n\n\n**Plot 2**:\n\nThe other way to evaluate whether or not \"hurricanes have gotten worse\" is to not look at the number of storms but to determine whether individual storms or storms as a whole have become more intense and/or destructive. One of the columns you may not have been able to fully figure out what information it contains is the column containing information on the \"accumulated cyclone energy\"^[Now that you have this information gp ahead and update your notes to add it to your short data set description.].\n\n1. Create a bar plot showing the ACE for each year. \n2. Chose a theme and customize the color of your bars^[You can specify color and fill for bar plots. Try setting the color and fill to the same and to different colors to see what happens when you have a bar plot with this many individual bars.] 3. Extra Challenge: Use `geom_hline()` to add a horizontal line indicating the mean ACE for the recorded time period.\n4. Write a short description for each figure summarizing the key results displayed and argue whether or not you think \"hurricanes have gotten worse\".\n\n:::\n\n\n::: {.callout-important icon=false}\n\n## {{< fa pen >}}   Did it!\n\n**Data Set**:\n\n\n\n**Plot 1:**\n\n\n\n**Plot 2:**\n\n\n\n**Summary of results**\n\n\n\n:::\n\n\n::: {.callout-tip icon=false collapse=true}\n\n## {{< fa person-chalkboard >}}    Pointers\n\nHere is what a draft of your first plot could look like before you finalize things like titles and themes:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](14_impacts_files/figure-html/unnamed-chunk-39-1.png){width=672}\n:::\n:::\n\n\nHere is what a draft of your first plot could look like before you finalize things like titles and themes:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](14_impacts_files/figure-html/unnamed-chunk-40-1.png){width=672}\n:::\n:::\n\n\n:::\n\n\n::: {.callout-note icon=false}\n\n## {{< fa clipboard-question >}}   Give it a whirl\n\nChoose five of the plots we have generated in this chapter and combine them into a single plot using `patchwork`; include at least two columns and two rows in your layout^[This can include your temperature anomaly data set as well.]. \n\nSave your plot in a way that retains proper proportions to make it easy for somebody else to easily see the details and discern the general patterns. Share your multi-panel plot in the `#assignment` channel of our slack workspace.\n\nUse your the figure you have created to support argue that \"the observed changes in the different components of the climate system are internally and physically consistent with increased global temperatures\". Draw from the descriptions you made for the figures throughout this challenges to summarize what you observe to support this claim. In your answer you will want to consider which of the data sets refer to which component of the earth-climate system and why the data sets you have looked at are consistent with increasing mean global temperatures.\n\nExtra challenge: You can use `#| fig-height` and `#| fig-width;` code chunk options to specify the dimensions of the output of a figure in the knitted document^[Yes, this does mean that you will need to check the format of your html output and potentially change it before you submit. Checking your html report before you submit is a good habit to have just to make sure that everything is rendering as expected]. When you initially render your `quarto` document you will find that the default dimensions will not format your you multi-panel plot in a way that does not make it super legible. Manipulate these parameters and re-knit your `html` to display your figure in an appropriate way.\n\n:::\n\n\n::: {.callout-important icon=false}\n\n## {{< fa pen >}}   Did it!\n\n**Figure**\n\n\n\n**The observed changes in the different components of the climate system are internally and physically consistent with increased global temperatures**\n\n\n\n\n:::\n\n\n::: {.callout-note icon=false}\n\n## {{< fa clipboard-question >}}   Consider this\n\nConsider the following and write a short paragraph (7-10 sentences):\n\n* Think back over the analyses we have performed for this and the previous chapter and argue whether the analysis you have performed should be considered descriptive, exploratory, inferential/predictive, or causal/mechanistic. \n* Describe both what you actually did, and then also briefly sketch out what your experimental design/analysis would need to look like if you had performed analysis in the other categories. \n* Causal/mechanistic analyses are the most involved frequently also the most difficult to perform. Argue whether or not your results are less meaningful or informative if they are not mechanistic/causal or whether they are still useful to support the initial thesis that climate change is unprecedented, unequivocally anthropogenic, and the impacts are already impacting all components of the earth-climate system.\n\n:::\n\n\n::: {.callout-important icon=false}\n\n## {{< fa pen >}}   Did it!\n\n[Your answer here]\n\n:::\n\n",
    "supporting": [
      "14_impacts_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}